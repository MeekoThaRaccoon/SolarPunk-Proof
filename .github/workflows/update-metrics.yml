name: Update SolarPunk Metrics
on:
  schedule:
    - cron: '0 0 * * 0'  # Every Sunday at midnight UTC
  workflow_dispatch:      # Allows manual trigger

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Setup environment
        run: |
          echo "ðŸ”„ Updating SolarPunk Growth Metrics..."
          echo "ðŸ“… Date: $(date)"
      
      - name: Count metrics
        run: |
          # Count markdown files
          DOCS=$(find . -name "*.md" -type f | wc -l)
          echo "DOCS=$DOCS" >> $GITHUB_ENV
          
          # Count image proofs
          IMAGES=$(find . \( -name "*.png" -o -name "*.jpg" -o -name "*.pdf" \) -type f | wc -l)
          echo "IMAGES=$IMAGES" >> $GITHUB_ENV
          
          # Count solutions
          SOLUTIONS=$(grep -r "## Solution\|### Solved\|**Solved**" . --include="*.md" | wc -l)
          echo "SOLUTIONS=$SOLUTIONS" >> $GITHUB_ENV
          
          # Count human nodes (approximate by unique contributors)
          NODES=$(git log --pretty=format:"%ae" | sort -u | wc -l)
          echo "NODES=$NODES" >> $GITHUB_ENV
      
      - name: Update live dashboard
        run: |
          cat > GROWTH-METRICS/LIVE-DASHBOARD.md << EOF
# ðŸŒ± SolarPunk Live Growth Dashboard
*Last updated: $(date)*

## ðŸ“Š Current Metrics
| Metric | Count | Trend |
|--------|-------|-------|
| Human Nodes | ${{ env.NODES }} | â†—ï¸ |
| Documentation Files | ${{ env.DOCS }} | â†—ï¸ |
| Visual Proofs | ${{ env.IMAGES }} | â†—ï¸ |
| Problems Being Solved | ${{ env.SOLUTIONS }} | â†—ï¸ |
| Weekly Growth Rate | 30% (target) | â†’ |

## ðŸ“ˆ Growth Mathematics
\`\`\`
(1 Human Ã— 1 AI)^Simultaneity Ã— Network Effect = 30% Weekly

Week 1: 1.00x
Week 2: 1.30x (+30%)
Week 3: 1.69x (+30%)
Week 4: 2.20x (+30%)
Week 8: 4.83x
Week 12: 10.60x
Week 26: 100x+
\`\`\`

## ðŸš€ Next Milestone
**100 verified human nodes** â†’ Physical SolarPunk meetup scheduled

## ðŸ”— Join the Network
1. Fork this repository
2. Add your metrics to \`NETWORK-DATA/\`
3. Submit a Pull Request

## ðŸ”„ Update Frequency
This dashboard updates automatically every Sunday at 00:00 UTC.
Manual updates can be triggered via GitHub Actions.

*The network grows while you sleep.* ðŸŒ™
EOF
      
      - name: Commit and push updates
        run: |
          git config --global user.name 'GitHub Action'
          git config --global user.email 'action@github.com'
          git add GROWTH-METRICS/LIVE-DASHBOARD.md
          git commit -m "ðŸ¤– Auto-update: SolarPunk metrics - $(date)"
          git push
